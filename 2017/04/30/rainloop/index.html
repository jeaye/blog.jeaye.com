<!DOCTYPE html><html><head><meta charset="utf-8"/><link rel="icon" type="image/png" href="https://blog.jeaye.com//assets/favicon-c551898801df70b89095c40cbb11f01ff876ecf59bfa153122137abe9459c576.png"><title>A RainLoop review and setup guide</title><meta name="author" content="jeaye"/><meta name="keywords" content="jeaye,jesse,wilkerson,c++,modern,engineering,manager,software,functional,clojure,programming,review, email, gpg, security, privacy, rainloop, tutorial"/><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="I'm a leader, a problem solver, and a hacker with a passion for privacy and security."><style>.icon{background-image:url("/assets/sprite-sheet-f829f47fe9f6353c7c632fee71002c94a29b8341725e19843f2c1b263869e4f2.png") !important}</style><style rel="stylesheet" type="text/css" integrity="sha256-FAEL2/AHw4sy6PSxUkN0Zt4TaPhbApIPciXM8UG6d7c=" crossorigin="anonymous">*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}body{display:flex;flex-flow:column nowrap;margin:0;font-family:sans-serif}a{text-decoration:none}.theme-old a{color:#3d92c9}.theme-red a{color:#c93d7a}.theme-teal a{color:#c2363c}.theme-green a{color:#3dc945}.theme-penny a{color:#ec331a}a:hover,a:focus{text-decoration:underline}.theme-old .gentle-body-color{color:#222}.theme-red .gentle-body-color{color:#222}.theme-teal .gentle-body-color{color:#222}.theme-green .gentle-body-color{color:#222}.theme-penny .gentle-body-color{color:#222}.header{display:flex;flex-flow:column wrap;align-items:center;margin:0;padding:2em 40px 2em 40px;text-align:center}.theme-old .header{background:#3d4f5d;color:#999}.theme-red .header{background:#5d3d4a;color:#999}.theme-teal .header{background:#3d5d5d;color:#999}.theme-green .header{background:#3d5d40;color:#999}.theme-penny .header{background:#812d39;color:#999}.header-inner{display:flex;flex-flow:row wrap}.header-description{flex:2;text-align:left;max-width:700px}.header-icon{display:flex;flex:1;justify-content:flex-end}.header-title,.header-short-pitch{margin:0}.header-short-pitch{font-weight:300}.theme-old .header-short-pitch{color:#b0cadb}.theme-red .header-short-pitch{color:#dbb0c3}.theme-teal .header-short-pitch{color:#b0dbd9}.theme-green .header-short-pitch{color:#b0dbb3}.theme-penny .header-short-pitch{color:#ffbbcb}.header-name{font-size:2.5em}.theme-old .header-name{color:#222}.theme-red .header-name{color:#222}.theme-teal .header-name{color:#222}.theme-green .header-name{color:#222}.theme-penny .header-name{color:#222}.nav{display:flex;flex-flow:row wrap;gap:0.5em;padding-top:0.5em}.nav-item{display:flex;flex:1;white-space:nowrap}.nav-item a{background:transparent;margin-top:1em;padding:6px 14px;letter-spacing:0.05em;font-size:85%}.theme-old .nav-item a{color:#fff;border:2px solid #b0cadb}.theme-red .nav-item a{color:#fff;border:2px solid #dbb0c3}.theme-teal .nav-item a{color:#fff;border:2px solid #b0dbd9}.theme-green .nav-item a{color:#fff;border:2px solid #b0dbb3}.theme-penny .nav-item a{color:#fff;border:2px solid #ffbbcb}.nav-item a:hover,.nav-item a:focus{text-decoration:none}.theme-old .nav-item a:hover,.theme-old .nav-item a:focus{border:2px solid #3d92c9}.theme-red .nav-item a:hover,.theme-red .nav-item a:focus{border:2px solid #c93d7a}.theme-teal .nav-item a:hover,.theme-teal .nav-item a:focus{border:2px solid #3dc9c3}.theme-green .nav-item a:hover,.theme-green .nav-item a:focus{border:2px solid #3dc945}.theme-penny .nav-item a:hover,.theme-penny .nav-item a:focus{border:2px solid #ff1345}.theme-old .special-nav-item a{border:2px solid #c2a086}.theme-red .special-nav-item a{border:2px solid #86c2aa}.theme-teal .special-nav-item a{border:2px solid #c28686}.theme-green .special-nav-item a{border:2px solid #c286bc}.theme-penny .special-nav-item a{border:2px solid #87e200}.theme-old .special-nav-item a:hover,.theme-old .special-nav-item a:focus{border:2px solid #c26d36}.theme-red .special-nav-item a:hover,.theme-red .special-nav-item a:focus{border:2px solid #36c285}.theme-teal .special-nav-item a:hover,.theme-teal .special-nav-item a:focus{border:2px solid #c2363c}.theme-green .special-nav-item a:hover,.theme-green .special-nav-item a:focus{border:2px solid #c236ba}.theme-penny .special-nav-item a:hover,.theme-penny .special-nav-item a:focus{border:2px solid #78af26}.panel-h-box{display:flex;flex:1;flex-flow:row wrap;gap:10em;justify-content:center;margin:0 3em 0 3em}.panel-v-box{display:flex;flex-flow:column wrap}.panel-gap{min-width:10em}.panel-subhead{text-transform:uppercase;padding:0;font-size:80%;font-weight:500;letter-spacing:0.1em}.theme-old .panel-subhead{color:#999}.theme-red .panel-subhead{color:#999}.theme-teal .panel-subhead{color:#999}.theme-green .panel-subhead{color:#999}.theme-penny .panel-subhead{color:#999}.main-panel,.toolbox-panel,.pgp-panel,.what-i-do-panel,.main-blog-panel{margin-top:2em}.main-panel{display:flex;flex:2;max-width:1280px;min-width:400px}.toolbox-panel{display:flex;flex:1;flex-flow:column nowrap;max-width:450px;min-width:200px}.what-i-do-panel{display:flex;flex:2;flex-flow:column nowrap;min-width:400px;max-width:900px}.what-i-do-h-box{display:flex;flex-flow:row nowrap;gap:4em;margin-top:1em}.what-i-do-thing{flex:1}.what-i-do-thing-title{font-size:1.0em;line-height:0.5em}.what-i-do-title{font-size:1.0em;line-height:0.5em;text-transform:uppercase;margin-bottom:2em}.theme-old .what-i-do-title{color:#443843}.theme-red .what-i-do-title{color:#443843}.theme-teal .what-i-do-title{color:#443843}.theme-green .what-i-do-title{color:#443843}.theme-penny .what-i-do-title{color:#443843}.what-i-do-big{font-size:2.5em;line-height:1em;font-weight:bold}.theme-old .what-i-do-big{color:#222}.theme-red .what-i-do-big{color:#222}.theme-teal .what-i-do-big{color:#222}.theme-green .what-i-do-big{color:#222}.theme-penny .what-i-do-big{color:#222}.job-title{font-size:2em;margin-bottom:0.2em}.theme-old .job-title{color:#222}.theme-red .job-title{color:#222}.theme-teal .job-title{color:#222}.theme-green .job-title{color:#222}.theme-penny .job-title{color:#222}.job-at{font-size:80%;font-weight:500}.theme-old .job-at{color:#999}.theme-red .job-at{color:#999}.theme-teal .job-at{color:#999}.theme-green .job-at{color:#999}.theme-penny .job-at{color:#999}.job-company{font-size:90%}.theme-old .job-company{color:#3d92c9}.theme-red .job-company{color:#c93d7a}.theme-teal .job-company{color:#c2363c}.theme-green .job-company{color:#3dc945}.theme-penny .job-company{color:#ec331a}.posts{display:flex;justify-content:center;flex-flow:column nowrap;max-width:1280px}.post{padding-bottom:2em}.post-header{display:flex;justify-content:space-between;align-items:center}.post-title{font-size:2em;margin-bottom:0.2em}.theme-old .post-title{color:#222}.theme-red .post-title{color:#222}.theme-teal .post-title{color:#222}.theme-green .post-title{color:#222}.theme-penny .post-title{color:#222}.theme-old .post-title a{color:#222;text-decoration-color:#222}.theme-red .post-title a{color:#222;text-decoration-color:#222}.theme-teal .post-title a{color:#222;text-decoration-color:#222}.theme-green .post-title a{color:#222;text-decoration-color:#222}.theme-penny .post-title a{color:#222;text-decoration-color:#222}.post-description{font-family:Georgia, "Cambria", serif;line-height:1.8em}.theme-old .post-description{color:#222}.theme-red .post-description{color:#222}.theme-teal .post-description{color:#222}.theme-green .post-description{color:#222}.theme-penny .post-description{color:#222}.post-meta{font-size:90%;margin:0}.theme-old .post-meta{color:#222}.theme-red .post-meta{color:#222}.theme-teal .post-meta{color:#222}.theme-green .post-meta{color:#222}.theme-penny .post-meta{color:#222}.post-date{text-align:right;white-space:nowrap}.theme-old .post-date{color:#222}.theme-red .post-date{color:#222}.theme-teal .post-date{color:#222}.theme-green .post-date{color:#222}.theme-penny .post-date{color:#222}.post-updated-date{font-size:90%;font-style:italic}.theme-old .post-updated-date{color:#5aba59}.theme-red .post-updated-date{color:#5aba59}.theme-teal .post-updated-date{color:#5aba59}.theme-green .post-updated-date{color:#5aba59}.theme-penny .post-updated-date{color:#5aba59}.post-category{margin:0 0.1em;padding:0.3em 1em;font-size:80%}.theme-old .post-category{color:#fff;background:#999}.theme-red .post-category{color:#fff;background:#999}.theme-teal .post-category{color:#fff;background:#999}.theme-green .post-category{color:#fff;background:#999}.theme-penny .post-category{color:#fff;background:#999}.theme-old .post-category-review{background:#61b360}.theme-red .post-category-review{background:#61b360}.theme-teal .post-category-review{background:#61b360}.theme-green .post-category-review{background:#61b360}.theme-penny .post-category-review{background:#61b360}.theme-old .post-category-privacy,.theme-old .post-category-security{background:#4d85d1}.theme-red .post-category-privacy,.theme-red .post-category-security{background:#4d85d1}.theme-teal .post-category-privacy,.theme-teal .post-category-security{background:#4d85d1}.theme-green .post-category-privacy,.theme-green .post-category-security{background:#4d85d1}.theme-penny .post-category-privacy,.theme-penny .post-category-security{background:#4d85d1}.theme-old .post-category-rant{background:#8156a7}.theme-red .post-category-rant{background:#8156a7}.theme-teal .post-category-rant{background:#8156a7}.theme-green .post-category-rant{background:#8156a7}.theme-penny .post-category-rant{background:#8156a7}.theme-old .post-category-tutorial{background:#bd4f64}.theme-red .post-category-tutorial{background:#bd4f64}.theme-teal .post-category-tutorial{background:#bd4f64}.theme-green .post-category-tutorial{background:#bd4f64}.theme-penny .post-category-tutorial{background:#bd4f64}.theme-old .post h1,.theme-old h2,.theme-old h3,.theme-old h4{color:#222}.theme-red .post h1,.theme-red h2,.theme-red h3,.theme-red h4{color:#222}.theme-teal .post h1,.theme-teal h2,.theme-teal h3,.theme-teal h4{color:#222}.theme-green .post h1,.theme-green h2,.theme-green h3,.theme-green h4{color:#222}.theme-penny .post h1,.theme-penny h2,.theme-penny h3,.theme-penny h4{color:#222}.post p,.post ol,.post ul{font-family:Georgia, "Cambria", serif}.theme-old .post p,.theme-old .post ol,.theme-old .post ul{color:#222}.theme-red .post p,.theme-red .post ol,.theme-red .post ul{color:#222}.theme-teal .post p,.theme-teal .post ol,.theme-teal .post ul{color:#222}.theme-green .post p,.theme-green .post ol,.theme-green .post ul{color:#222}.theme-penny .post p,.theme-penny .post ol,.theme-penny .post ul{color:#222}.post p a{font-weight:600}.skills{margin:0;padding:0 3em 0 0}.skill{display:flex;gap:1em;padding:1em 0;border-bottom:1px solid #ccc}.skill:last-child{border:none !important}.skill-name{font-size:0.8em;font-weight:bold;align-self:center}.theme-old .skill-name{color:#222}.theme-red .skill-name{color:#222}.theme-teal .skill-name{color:#222}.theme-green .skill-name{color:#222}.theme-penny .skill-name{color:#222}.main-blog-panel{display:flex;justify-content:center;margin-left:10em;margin-right:10em}.blog-header{display:flex;flex-flow:row nowrap;justify-content:space-between}.border-bottom{border-bottom:1px solid #eee}.related-list{list-style-type:none}.related-list li{padding-bottom:0.5em;border-bottom:1px solid #ccc}.related-list li:last-child{border:none}.related-post-title{font-size:1em;margin-bottom:0.2em}.theme-old .related-post-title{color:#222}.theme-red .related-post-title{color:#222}.theme-teal .related-post-title{color:#222}.theme-green .related-post-title{color:#222}.theme-penny .related-post-title{color:#222}.theme-old .related-post-title a{color:#222;text-decoration-color:#222}.theme-red .related-post-title a{color:#222;text-decoration-color:#222}.theme-teal .related-post-title a{color:#222;text-decoration-color:#222}.theme-green .related-post-title a{color:#222;text-decoration-color:#222}.theme-penny .related-post-title a{color:#222;text-decoration-color:#222}figure{text-align:center;margin:0 auto}figure img{border:1px solid rgba(50,50,50,0.5);border-radius:2px;padding:5px;background:#fff}.figure-2-3{width:66%}figcaption{padding:1em 1em 2em 1em;word-wrap:normal;text-align:center;display:inline-block !important;width:66%}code{overflow:auto}.icon-feed{background-position:0px 0px;width:24px;height:30px}.icon-j{background-position:-24px 0px;width:158px;height:155px}code:not([id='typeans']){padding-left:5px;padding-right:5px;border:1px solid;border-color:lightgrey;border-radius:5px}pre code{padding:5px}.highlight .lineno{color:#ccc;display:inline-block;padding:0 5px;border-right:1px solid #ccc}.highlight pre code{display:block;white-space:pre-wrap;overflow-x:auto;word-wrap:normal}.highlight .hll{background-color:#49483e}.highlight{background:#272822;color:#f8f8f2;border-radius:5px}.highlight .c{color:#75715e}.highlight .err{color:#960050;background-color:#1e0010}.highlight .k{color:#66d9ef}.highlight .l{color:#ae81ff}.highlight .n{color:#f8f8f2}.highlight .o{color:#f92672}.highlight .p{color:#f8f8f2}.highlight .ch{color:#75715e}.highlight .cm{color:#75715e}.highlight .cp{color:#75715e}.highlight .cpf{color:#75715e}.highlight .c1{color:#75715e}.highlight .cs{color:#75715e}.highlight .gd{color:#f92672}.highlight .ge{font-style:italic}.highlight .gi{color:#a6e22e}.highlight .gs{font-weight:bold}.highlight .gu{color:#75715e}.highlight .kc{color:#66d9ef}.highlight .kd{color:#66d9ef}.highlight .kn{color:#f92672}.highlight .kp{color:#66d9ef}.highlight .kr{color:#66d9ef}.highlight .kt{color:#66d9ef}.highlight .ld{color:#e6db74}.highlight .m{color:#ae81ff}.highlight .s{color:#e6db74}.highlight .na{color:#a6e22e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#a6e22e}.highlight .no{color:#66d9ef}.highlight .nd{color:#a6e22e}.highlight .ni{color:#f8f8f2}.highlight .ne{color:#a6e22e}.highlight .nf{color:#a6e22e}.highlight .nl{color:#f8f8f2}.highlight .nn{color:#f8f8f2}.highlight .nx{color:#a6e22e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f92672}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f92672}.highlight .w{color:#f8f8f2}.highlight .mb{color:#ae81ff}.highlight .mf{color:#ae81ff}.highlight .mh{color:#ae81ff}.highlight .mi{color:#ae81ff}.highlight .mo{color:#ae81ff}.highlight .sa{color:#e6db74}.highlight .sb{color:#e6db74}.highlight .sc{color:#e6db74}.highlight .dl{color:#e6db74}.highlight .sd{color:#e6db74}.highlight .s2{color:#e6db74}.highlight .se{color:#ae81ff}.highlight .sh{color:#e6db74}.highlight .si{color:#e6db74}.highlight .sx{color:#e6db74}.highlight .sr{color:#e6db74}.highlight .s1{color:#e6db74}.highlight .ss{color:#e6db74}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#a6e22e}.highlight .vc{color:#f8f8f2}.highlight .vg{color:#f8f8f2}.highlight .vi{color:#f8f8f2}.highlight .vm{color:#f8f8f2}.highlight .il{color:#ae81ff}
</style><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="/feed.xml"/></head><body class="theme-penny"><div class="header"><div class="header-inner"><div class="header-description"><h1 class="header-title">My name is <span class="header-name">Jeaye</span></h1><h2 class="header-short-pitch">I'm a leader, a problem solver, and a hacker with a passion for privacy and security.</h2></div><div class="header-icon"><div class="icon icon-j"></div></div></div><nav class="nav"><div class="nav-item"> <a href="https://jeaye.com/">About</a></div><div class="nav-item"> <a href="https://github.com/jeaye">Github</a></div><div class="nav-item"> <a href="/">Blog</a></div><div class="nav-item"> <a href="https://jeaye.com/contact">Contact</a></div><div class="nav-item special-nav-item"> <a href="https://jeaye.com/contact">Hire Me!</a></div> </nav></div><div class="main-blog-panel"><div class="posts"> <section class="post"> <header class="post-header"><h2 class="post-title"> <a href="/2017/04/30/rainloop/" title="/2017/04/30/rainloop/"> A RainLoop review and setup guide </a></h2><div class="post-date"> April 30, 2017</div> </header><p><a href="TODO">RainLoop</a> is a web-based <a href="https://en.wikipedia.org/wiki/Email_client">MUA</a> similar to <a href="TODO">Roundcube</a>, <a href="TODO">Mailpile</a>, and the like. When looking to setup portable email access for my wife, who no longer is happy with just <a href="https://www.mozilla.org/en-US/thunderbird/">Thunderbird</a>, RainLoop seemed like a reasonable choice. Here are some integration notes, as well as a review and some ranting, based on my afternoon setting it up.</p><h3 id="ui-and-functionality">UI and functionality</h3><p>My wife has been tolerating RainLoop, on both desktop and mobile. A number of annoyances have occurred, most of which are minor, but the sum of which is significant.</p><ul><li><p>There is no auto refresh on desktop or mobile. The refresh button needs to be clicked in order for mail to be checked. This requires conscious effort to regularly check the mail, rather than be notified when something arrives in the inbox.</p></li><li><p>On mobile, the back button doesn’t behave properly; after selecting an email, the back button will not return to the inbox. After hitting it, failing, and manually returning to the inbox, the search will have been changed to <code class="highlighter-rouge">is:flagged</code>.</p><p>Unfortunately, it’s more buggy than that. After asking her to reproduce it for me a second time, she was in her inbox, selected an email, and the back button then brought her to the settings menu. For now, she’s just not using that button.</p></li><li><p>On mobile, the hamburger menu (as it is on desktop) is missing. This means it’s impossible to mark emails as <em>Read</em> or <em>Flagged</em>. Handy features like <em>Mark all as read</em>, which live in that hamburger menu, are also not present. This does further cripple the mobile version.</p></li><li><p>There is no autocompletion of names or emails, based on existing emails in one’s inbox. Instead, it seems that they may need to be added to the contacts list. Manually adding each contact is tiresome, tedious work and the completion of emails and names in the To, Cc, etc forms should be filled in a smart way.</p></li><li><p>The refresh icon, in the inbox view, is entirely unintuitive; neither of us knew what it was supposed to do when we first saw it. It’s not a tough thing to learn, but that doesn’t seem like the place we should be breaking new ground.</p></li><li><p>While there are default themes, none of them change the color of the message body background, which remains a glaring white. Some more complete default themes would be appreciated, for those with sensitive eyes.</p></li><li><p>As an admin, there’s no clear way of knowing if the Community or Standard version of RainLoop is installed. From what I’ve seen, the best way is to go to the admin page, then to the About section. If you see anything, under the version, about licensing and subscriptions, you’re on the Standard version. If you see nothing, you’re on the Community version. This should be made more clear.</p></li><li><p>There is absolutely no community to be found. No forums, no IRC channel, Gitter, Slack, etc. Ironically, no mailing list either. There is only a support email, where one can contact the RainLoop devs. This is unsettling.</p></li></ul><p>There are a couple of features and positive points which are worth noting. While the critical feedback is more vocal, RainLoop does have some much appreciated aspects.</p><ul><li><p>The ease of setup should not be understated and is much appreciated. Aside from unzipping and setting up Apache, nothing is required. The default config is no config and that’s both comforting and somewhat unsettling.</p></li><li><p>The admin console is simple and effective, though it could provide more information on what each option actually does.</p></li><li><p>The support for “smart” multiple identities would’ve been sorely missed, but it behaves exactly as one would expect. For an example, my wife has multiple emails, each one using a different name. It’s possible to select the default profile to use, when composing without replying. Aside from that, RainLoop will automatically use the profile which matches the To of any email she receives. So, she can always just reply and RainLoop will use the correct profile, name, and ReplyTo.</p></li><li><p>While more complete themes would be appreciated, the presence of themes out of the box is a nice touch.</p></li></ul><h3 id="community-vs-standard-version">Community vs Standard version</h3><p>The <a href="http://www.rainloop.net">website for RainLoop</a> is quite minimal, but so is the setup itself. The <a href="http://www.rainloop.net/purchase/">biggest decision</a> one needs to make is whether or not to use the Community (<a href="https://en.wikipedia.org/wiki/Affero_General_Public_License">AGPL</a>) version or the Standard (<a href="https://en.wikipedia.org/wiki/Proprietary_software">closed-source</a>) version. As of writing, for personal sites, the Community version lacks only one feature: single-click updating. Instead, the user is directed to install the new version atop the old one, manually.</p><h4 id="no-single-click-updating">No single-click updating?</h4><p>As far as licensing is concerned, that’s not a problem at all. The approach where the core of a product can be open source, while some non-crucial features cost money, is a pretty reasonable deal. Still, there’s no need to use a closed-source version just to get single-click updating. Manually updating in-place, however, is error-prone, non-atomic (meaning it’s not all or nothing), imperative, and not the <a href="http://nixos.org/">NixOS</a> way. We can do better.</p><h3 id="basic-installation">Basic installation</h3><p>Following the <a href="http://www.rainloop.net/docs/installation/">documentation</a>, basic installation is a breeze.</p><p><strong>Note:</strong> <em>The below uses <code class="highlighter-rouge">/var/www/rainloop</code>, but this could be anywhere on your machine which is capable of serving data to Apache.</em></p><h4 id="download-and-unzip">Download and unzip</h4><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wget http://www.rainloop.net/repository/webmail/rainloop-community-latest.zip
<span class="nv">$ </span><span class="nb">mkdir</span> /var/www/rainloop
<span class="nv">$ </span>unzip rainloop-community-latest.zip <span class="nt">-d</span> /var/www/rainloop
</code></pre></div></div><h4 id="hook-into-apache">Hook into Apache</h4><p>From there, a basic Apache setup can just look in the <code class="highlighter-rouge">rainloop</code> directory.</p><div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nl">Directory</span><span class="sr"> /var/www/rainloop</span><span class="p">&gt;
</span>  <span class="nc">DirectoryIndex</span> index.php
  <span class="nc">Options</span> -Indexes +ExecCGI
  <span class="nc">AllowOverride</span> <span class="ss">All</span>
  <span class="nc">Order</span> deny,allow
  <span class="nc">Allow</span> <span class="ss">from</span> all
  <span class="nc">Require</span> all granted
<span class="p">&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
</span></code></pre></div></div><p>As per the documentation, all configuration, caches, and assorted private data is included within the top-level <code class="highlighter-rouge">rainloop</code> directory, but within a <code class="highlighter-rouge">data</code> directory. Ideally, no users should be able to access that, so it should be disabled within Apache.</p><div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nl">Directory</span><span class="sr"> /var/www/rainloop/data</span><span class="p">&gt;
</span>  <span class="nc">Options</span> -Indexes
  <span class="nc">Deny</span> <span class="ss">from</span> all
<span class="p">&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
</span></code></pre></div></div><p>Aside from setting up <a href="https://letsencrypt.org/">HTTPS</a>, which should be considered a requirement for any web application, that’s it. As per the docs, manual upgrading involves unzipping the newest release on top of the live version. As per the intro, we can do better.</p><h3 id="automatically-and-atomically-updating">Automatically and atomically updating</h3><p>The RainLoop devs are kind enough to package a <a href="https://en.wikipedia.org/wiki/Pretty_Good_Privacy">PGP signature</a> for each release. Using a script, it’d be straightforward to compare that signature with the one of our live version. If the two differ, we can assume a new version has been released. The new version can be downloaded and extracted in a new directory (copied from the live one). The new signature should be kept in the new directory, so the script can know when the next update arrives. Once the new setup is complete, a symbolic link can be atomically updated to point to the latest version.</p><h4 id="directory-layout">Directory layout</h4><p>The current directory layout, as per the basic installation is similar to this.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tree <span class="nt">-L</span> 1 /var/www/rainloop
/var/www/rainloop
├── data
├── index.php
└── rainloop
</code></pre></div></div><p>Instead, each version can be dated. RainLoop doesn’t have specific version numbers in its release zips, so the date is the next easiest thing to use. The <code class="highlighter-rouge">latest</code> link will just point to the latest version. Since RainLoop isn’t very large (about 25MB), it likely doesn’t hurt to keep these versions around. If it does, a simple daily cron can clean up all but the last N versions. Here’s an example of what the new setup would look like.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tree <span class="nt">-L</span> 2 /var/www/rainloop
/var/www/rainloop
├── latest -&gt; /var/www/rainloop/version-2017-04-23.19:09:29
├── version-2017-03-01.13:14:11
│   ├── data
│   ├── index.php
│   ├── rainloop
│   └── rainloop-community-latest.zip.asc
├── version-2017-04-21.13:03:58
│   ├── data
│   ├── index.php
│   ├── rainloop
│   └── rainloop-community-latest.zip.asc
└── version-2017-04-23.19:09:29
    ├── data
    ├── index.php
    ├── rainloop
    └── rainloop-community-latest.zip.asc
</code></pre></div></div><h4 id="upgrade-script">Upgrade script</h4><p>With the theory out of the way, here’s a working upgrade script which follows all of the above ideas. It can be run manually, in a cron job, or perhaps hooked into NixOS’ activation scripts. If no upgrade is available, since the live signature matches the latest one on the RainLoop downloads page, the script does nothing.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>

<span class="nb">set</span> <span class="nt">-eu</span> <span class="nt">-o</span> pipefail

<span class="c"># The only thing you'll need to change</span>
<span class="nv">local_webmail</span><span class="o">=</span>/var/www/rainloop <span class="c"># Wherever you're running rainloop</span>

<span class="nv">zip_file</span><span class="o">=</span>rainloop-community-latest.zip
<span class="nv">signature_file</span><span class="o">=</span><span class="nv">$zip_file</span>.asc
<span class="nv">remote_webmail</span><span class="o">=</span>https://www.rainloop.net/repository/webmail

<span class="nb">printf</span> <span class="s2">"RainLoop: checking for upgrades... "</span>
<span class="nv">new_zip_signature</span><span class="o">=</span><span class="k">$(</span>curl <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$remote_webmail</span><span class="s2">/</span><span class="nv">$signature_file</span><span class="s2">"</span><span class="k">)</span>
<span class="nv">old_zip_signature</span><span class="o">=</span><span class="k">$(</span><span class="nb">cat</span> <span class="s2">"</span><span class="nv">$local_webmail</span><span class="s2">/latest/</span><span class="nv">$signature_file</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true</span><span class="k">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$new_zip_signature</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"</span><span class="nv">$old_zip_signature</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span>
<span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"found"</span>
  <span class="nb">echo</span> <span class="s2">"RainLoop: upgrading..."</span>
  <span class="nv">temp_dir</span><span class="o">=</span><span class="k">$(</span><span class="nb">mktemp</span> <span class="nt">-d</span><span class="k">)</span>
  <span class="nb">pushd</span> <span class="s2">"</span><span class="nv">$temp_dir</span><span class="s2">"</span>
    gpg2 <span class="nt">--import</span> &lt;<span class="o">(</span>curl <span class="nt">-s</span> <span class="s2">"https://www.rainloop.net/repository/RainLoop.asc"</span><span class="o">)</span>

    <span class="c"># Download new version</span>
    wget <span class="s2">"</span><span class="nv">$remote_webmail</span><span class="s2">/</span><span class="nv">$zip_file</span><span class="s2">"</span>
    gpg2 <span class="nt">--verify</span> &lt;<span class="o">(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$new_zip_signature</span><span class="s2">"</span><span class="o">)</span> <span class="s2">"</span><span class="nv">$zip_file</span><span class="s2">"</span>

    <span class="c"># Start from the latest, if it's there</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$local_webmail</span><span class="s2">/latest"</span> <span class="o">]</span><span class="p">;</span>
    <span class="k">then
      </span>rsync <span class="nt">-av</span> <span class="s2">"</span><span class="nv">$local_webmail</span><span class="s2">/latest/"</span> <span class="nb">.</span>
    <span class="k">fi

    </span>unzip <span class="nt">-o</span> <span class="s2">"</span><span class="nv">$zip_file</span><span class="s2">"</span>
    <span class="nb">rm</span> <span class="s2">"</span><span class="nv">$zip_file</span><span class="s2">"</span>

    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$new_zip_signature</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$signature_file</span><span class="s2">"</span>
  <span class="nb">popd

  </span><span class="nv">new_version</span><span class="o">=</span><span class="k">$(</span><span class="nb">date</span> +<span class="s1">'version-%Y-%m-%d.%H:%M:%S'</span><span class="k">)</span>
  <span class="nv">new_path</span><span class="o">=</span><span class="nv">$local_webmail</span>/<span class="nv">$new_version</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$new_path</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span>
  <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"RainLoop: directory already exists: </span><span class="nv">$new_path</span><span class="s2">"</span>
    <span class="nb">exit </span>1
  <span class="k">fi</span>

  <span class="c"># Move the new version into place and setup permissions</span>
  <span class="nb">mv</span> <span class="s2">"</span><span class="nv">$temp_dir</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$new_path</span><span class="s2">"</span>
  find <span class="s2">"</span><span class="nv">$new_path</span><span class="s2">"</span> <span class="nt">-type</span> d <span class="nt">-exec</span> <span class="nb">chmod </span>755 <span class="o">{}</span> <span class="se">\;</span>
  find <span class="s2">"</span><span class="nv">$new_path</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">chmod </span>644 <span class="o">{}</span> <span class="se">\;</span>
  <span class="nb">chown</span> <span class="nt">-R</span> http:users <span class="s2">"</span><span class="nv">$new_path</span><span class="s2">"</span>

  <span class="c"># Atomically link/upgrade</span>
  <span class="nb">ln</span> <span class="nt">-sfn</span> <span class="s2">"</span><span class="nv">$new_path</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$local_webmail</span><span class="s2">/latest"</span>

  <span class="nb">echo</span> <span class="s2">"RainLoop: upgrade complete"</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"not found"</span>
<span class="k">fi</span>
</code></pre></div></div><h4 id="apache-tweaks">Apache tweaks</h4><p>The only tweak needed is in the Apache config. Apache should just point at the <code class="highlighter-rouge">latest</code> link, so upgrading will never require changing its configs. That link needs to be followed, so <code class="highlighter-rouge">+FollowSymLinks</code> should be added, too. Since the upgrade is atomic (all or nothing), Apache won’t ever be serving up a half-upgraded RainLoop. It’s either fully on one version, or fully on another. This is just like NixOS and the way the <a href="http://nixos.org/nix/">Nix</a> package manage works.</p><div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Each directory has 'latest' at the end now</span>
<span class="p">&lt;</span><span class="nl">Directory</span><span class="sr"> /var/www/rainloop/latest</span><span class="p">&gt;
</span>  <span class="nc">DirectoryIndex</span> index.php
  <span class="c"># Following symbolic links is allowed here</span>
  <span class="nc">Options</span> -Indexes +FollowSymLinks +ExecCGI
  <span class="nc">AllowOverride</span> <span class="ss">All</span>
  <span class="nc">Order</span> deny,allow
  <span class="nc">Allow</span> <span class="ss">from</span> all
  <span class="nc">Require</span> all granted
<span class="p">&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
&lt;</span><span class="nl">Directory</span><span class="sr"> /var/www/rainloop/latest/data</span><span class="p">&gt;
</span>  <span class="nc">Options</span> -Indexes
  <span class="nc">Deny</span> <span class="ss">from</span> all
<span class="p">&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
</span></code></pre></div></div><h3 id="a-matter-of-security">A matter of security</h3><p>Last, but absolutely not least, is RainLoop’s GPG support. It was originally implemented as per <a href="https://github.com/RainLoop/rainloop-webmail/issues/53">this issue</a>. The problem is, it’s implemented entirely client-side, with the private key being stored in the browser. Each RainLoop session, you upload your GPG private key so that you can encrypt/decrypt/sign properly. As a matter of portability, this is terribly inconvenient.</p><p>As a matter of security, the current implementation has a number of issues, ranging from the <a href="https://github.com/RainLoop/rainloop-webmail/issues/1167">inability to verify GPG signatures</a>, to the <a href="https://github.com/RainLoop/rainloop-webmail/issues/1363">storage of encrypted drafts in plain text</a>, to the <a href="https://github.com/RainLoop/rainloop-webmail/issues/374">visibility of other users’ private keys</a>, since they’re just stored in the browser. To make matters worse, <em>the developers of RainLoop consistently close GPG-related issues, without comment</em> (see <a href="https://github.com/RainLoop/rainloop-webmail/issues/280">here</a>, <a href="https://github.com/RainLoop/rainloop-webmail/issues/175">here</a>, <a href="https://github.com/RainLoop/rainloop-webmail/issues/349">here</a>, <a href="https://github.com/RainLoop/rainloop-webmail/issues/447">here</a>, and <a href="https://github.com/RainLoop/rainloop-webmail/issues/53">here</a>). Those which are not closed are often left unaddressed for years.</p><p>As such, I cannot possibly recommend that <em>anyone</em> use RainLoop’s GPG implementation. Until <a href="https://github.com/mailpile/Mailpile">Mailpile</a> is stable, at least, RainLoop provides a usable webmail application. Don’t expect to get your security kicks here though, and don’t expect to find a community.</p></section><hr/><div><div class="border-bottom"><h1 class="panel-subhead">Related posts</h1><ul class="related-list"><li><h2 class="related-post-title"> <a href="/2018/04/11/system76-firmware/">Removing IME: Upgrading System76 firmware on Arch</a> <span class="post-category post-category-tutorial">tutorial</span> <span class="post-category post-category-security">security</span> <span class="post-category post-category-privacy">privacy</span></h2></li><li><h2 class="related-post-title"> <a href="/2017/12/16/firefox/">Don't abandon Mozilla Firefox just yet</a> <span class="post-category post-category-privacy">privacy</span> <span class="post-category post-category-security">security</span></h2></li><li><h2 class="related-post-title"> <a href="/2017/11/30/noscript/">A guide to using NoScript 10.x</a> <span class="post-category post-category-privacy">privacy</span> <span class="post-category post-category-security">security</span> <span class="post-category post-category-tutorial">tutorial</span></h2></li><li><h2 class="related-post-title"> <a href="/2017/10/31/clojure-keywords/">The five common forms of Clojure keywords</a> <span class="post-category post-category-tutorial">tutorial</span></h2></li></ul></div></div></div></div></div> <footer> </footer></body></html>